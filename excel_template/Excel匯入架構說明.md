# 文化部原村管考系統 - Excel 匯入架構說明

## 架構總覽

本架構包含三個分頁（Tabs），彼此具備關聯邏輯：

```
┌─────────────────────────────────────────────────────────────┐
│                    計畫資料（主表）                          │
│  定義：關鍵項目 ID、工作項目名稱、預算科目、核定金額         │
└─────────────────────────────────────────────────────────────┘
           │                              │
           │ VLOOKUP                      │ VLOOKUP
           ▼                              ▼
┌─────────────────────────┐    ┌─────────────────────────────┐
│     月報表（填報）       │    │     經費支出（核銷）         │
│  工作事項 → 關鍵項目     │    │  支出項目 → 預算科目         │
│  自動帶出預定目標值      │    │  自動帶出核定金額與餘額       │
└─────────────────────────┘    └─────────────────────────────┘
```

---

## 分頁一：計畫資料（主表）

### 欄位定義

| 欄位名稱 | 資料類型 | 說明 | 範例 |
|---------|---------|------|------|
| **關鍵項目 ID** | 文字 | 唯一識別碼，供月報表連動 | KR-001 |
| **工作項目名稱** | 文字 | 計畫書中的關鍵項目名稱 | 辦理計畫說明會 |
| **預算科目** | 文字 | 預算分類代碼，供經費支出連動 | 01-人事費 |
| **核定金額** | 數值 | 該科目的核定預算金額 | 50,000 |
| **預定目標值** | 數值 | 該項目的預定達成數量 | 1 |
| **預計完成日** | 日期 | 預計完成日期 | 2026/03/31 |

### 預算科目代碼對照

| 代碼 | 科目名稱 | 說明 |
|------|---------|------|
| 01-人事費 | 人事費 | 專案人員薪資、勞健保等 |
| 02-業務費 | 業務費 | 活動執行、材料、交通等 |
| 03-雜支 | 雜支 | 行政雜支、文具等 |

---

## 分頁二：月報表（填報）

### 欄位定義

| 欄位名稱 | 資料類型 | 連動方式 | 說明 |
|---------|---------|---------|------|
| **填報月份** | 文字 | 手動輸入 | 格式：2026年01月 |
| **對應項目 ID** | 文字 | 下拉選單 | 連動「計畫資料」的關鍵項目 ID |
| **工作項目名稱** | 文字 | VLOOKUP 自動帶入 | 根據項目 ID 自動顯示 |
| **預定目標值** | 數值 | VLOOKUP 自動帶入 | 根據項目 ID 自動顯示 |
| **本月達成數** | 數值 | 手動輸入 | 本月實際完成數量 |
| **達成率(%)** | 百分比 | 公式計算 | 本月達成數 ÷ 預定目標值 |
| **本月執行內容** | 文字 | 手動輸入 | 描述本月執行的具體內容 |

### VLOOKUP 公式範例

```excel
【工作項目名稱】自動帶入公式：
=IFERROR(VLOOKUP(C6,計畫資料!$B$6:$G$20,2,FALSE),"")

說明：
- C6：對應項目 ID 欄位
- 計畫資料!$B$6:$G$20：計畫資料表的資料範圍
- 2：取得第 2 欄（工作項目名稱）
- FALSE：精確比對

【預定目標值】自動帶入公式：
=IFERROR(VLOOKUP(C6,計畫資料!$B$6:$G$20,5,FALSE),"")

說明：
- 5：取得第 5 欄（預定目標值）

【達成率】計算公式：
=IFERROR(F6/E6,"")

說明：
- F6：本月達成數
- E6：預定目標值
```

---

## 分頁三：經費支出（核銷）

### 欄位定義

| 欄位名稱 | 資料類型 | 連動方式 | 說明 |
|---------|---------|---------|------|
| **日期** | 日期 | 手動輸入 | 支出日期 |
| **對應科目** | 文字 | 下拉選單 | 連動「計畫資料」的預算科目 |
| **科目名稱** | 文字 | VLOOKUP 自動帶入 | 根據科目代碼自動顯示 |
| **核定金額** | 數值 | SUMIF 自動帶入 | 該科目的核定預算總額 |
| **經費來源** | 文字 | 下拉選單 | 補助款 / 自籌款 |
| **本月報支金額** | 數值 | 手動輸入 | 本次核銷金額 |
| **累計支出** | 數值 | SUMIF 計算 | 該科目的累計支出金額 |
| **剩餘餘額** | 數值 | 公式計算 | 核定金額 - 累計支出 |

### VLOOKUP / SUMIF 公式範例

```excel
【核定金額】自動帶入公式：
=IFERROR(SUMIF(計畫資料!$D$6:$D$20,C6,計畫資料!$E$6:$E$20),"")

說明：
- 計畫資料!$D$6:$D$20：預算科目欄位範圍
- C6：當前選擇的科目代碼
- 計畫資料!$E$6:$E$20：核定金額欄位範圍
- 使用 SUMIF 是因為同一科目可能有多筆預算

【累計支出】計算公式：
=SUMIF($C$6:$C$100,C6,$G$6:$G$100)

說明：
- $C$6:$C$100：對應科目欄位範圍（固定）
- C6：當前科目代碼
- $G$6:$G$100：本月報支金額欄位範圍（固定）

【剩餘餘額】計算公式：
=IFERROR(E6-H6,"")

說明：
- E6：核定金額
- H6：累計支出
```

---

## 重要提醒

### 1. 經費來源區分

在「經費支出」分頁新增了「經費來源」欄位（下拉選單：補助款/自籌款），這能幫助後端系統在產出「經費撥付申請表」時自動分類。

### 2. 人事費上限檢查

依據文化部獎補助資訊網規範，人事費通常有上限限制（例如核定金額的 30%）。建議在系統中加入自動檢核：

```excel
【人事費超支警示公式】
=IF(AND(C6="01-人事費", H6>核定金額*0.3), "⚠️ 超過上限", "")
```

### 3. 下拉選單設定

在 Excel 中設定下拉選單的步驟：
1. 選取要設定的儲存格範圍
2. 資料 → 資料驗證
3. 允許：清單
4. 來源：輸入選項或選取範圍

---

## 系統整合建議

### 匯入流程

```
1. 使用者下載 Excel 範本
2. 填寫「計畫資料」主表
3. 每月填寫「月報表」與「經費支出」
4. 上傳至系統進行匯入
5. 系統驗證資料完整性
6. 匯入成功後自動更新儀表板
```

### 資料驗證規則

| 欄位 | 驗證規則 |
|------|---------|
| 關鍵項目 ID | 必填、唯一、格式：KR-XXX |
| 核定金額 | 必填、正數 |
| 對應項目 ID | 必須存在於計畫資料中 |
| 對應科目 | 必須存在於計畫資料中 |
| 經費來源 | 必須為「補助款」或「自籌款」|

---

## 檔案清單

| 檔案名稱 | 說明 |
|---------|------|
| 原村管考系統_Excel匯入架構範本.xlsx | Excel 範本檔案 |
| create_excel_template.py | Python 生成腳本 |
| Excel匯入架構說明.md | 本說明文件 |
