# 文化部原村計畫管考系統 - 需求核實報告

## 根據客戶對話截圖整理的需求清單與核實狀態

---

## 一、系統架構需求

### 1. 權限控制 - Ragic 概念
**需求**：各單位可以看到自己的，看不到別人的；文化部要看到全部的
**狀態**：✅ 已實現
**程式碼位置**：`App.tsx` 第 93-95 行
```javascript
const visibleProjects = isAdmin 
  ? projects 
  : projects.filter(p => p.unitId === currentUser.unitId || p.liaison.email === currentUser.email);
```

### 2. 兩個主要表單
**需求**：計畫基本資料表 + 計畫執行管控表
**狀態**：✅ 已實現
- 計畫基本資料表：`ProjectForm.tsx`
- 計畫執行管控表：`ProjectExecutionControl.tsx`

---

## 二、計畫基本資料表需求

### 3. 地址資訊和金額資訊要放到輔導委員前面
**需求**：地址資訊和金額資訊要放到輔導委員前面
**狀態**：❌ 未實現
**問題**：`ProjectForm.tsx` 目前沒有包含完整的基本資料欄位（地址、金額、輔導委員等）
**需要修改**：需要在 ProjectForm.tsx 中添加完整的基本資料欄位，並按正確順序排列

### 4. 漏了實施地點
**需求**：實施地點欄位（類型：原鄉/都市，詳細地點）
**狀態**：⚠️ 部分實現
**問題**：`types.ts` 有 `siteType` 和 `sites` 欄位，但 `ProjectForm.tsx` 沒有對應的輸入介面
**需要修改**：需要在 ProjectForm.tsx 中添加實施地點輸入區塊

### 5. 地點可能會有多個，要有新增按鈕
**需求**：實施地點可以新增多個
**狀態**：❌ 未實現
**問題**：`types.ts` 中 `sites: string[]` 支援多個地點，但 UI 沒有新增按鈕
**需要修改**：需要在 ProjectForm.tsx 中添加地點新增/刪除功能

### 6. 計畫基本資料欄位順序
**需求**：
- 計畫代表人（姓名、職稱、電話、手機、email）
- 計畫聯絡人（姓名、職稱、電話、手機、email）
- 立案地址（文字）
- 聯絡地址（文字）
- 實施地點（原鄉/都市、詳細文字）
- 申請金額（數字）
- 核定金額（數字）
- 輔導委員（姓名、職稱、電話、手機、email）
- 主責人員（姓名、職稱、電話、手機、email）

**狀態**：❌ 未實現
**問題**：`ProjectForm.tsx` 目前只有願景、OKR、經費預算、撥付截止日期，缺少上述基本資料欄位
**需要修改**：需要完整重構 ProjectForm.tsx 添加所有基本資料欄位

### 7. 新增目標和關鍵結果放到計畫基本資料中
**需求**：把新增目標和關鍵結果和預算金額放到計畫基本資料中
**狀態**：✅ 已實現
**程式碼位置**：`ProjectForm.tsx` 包含 OKR 和經費預算編列

---

## 三、計畫執行管控表需求

### 8. 關鍵結果要能新增列數
**需求**：關鍵結果要能新增列數，每一列都要有預計完成日期、執行成果說明、預算金額、實際執行金額
**狀態**：⚠️ 部分實現
**問題**：
- `types.ts` 中 `KeyResult` 只有 `id, description, targetValue, expectedDate`
- 缺少：預算金額、實際執行金額欄位
- `ProjectForm.tsx` 中的關鍵結果 UI 不完整（程式碼被省略）
**需要修改**：
1. 更新 `types.ts` 中的 `KeyResult` 介面
2. 完善 `ProjectForm.tsx` 中的關鍵結果編輯 UI

### 9. 月報卡片排列順序
**需求**：進度填報 → 支出明細 → 輔導紀錄回應（撥付進度不放在月報）
**狀態**：✅ 已實現
**程式碼位置**：`ProjectExecutionControl.tsx`
- 第 159-226 行：進度填報（標記為 1）
- 第 228-336 行：支出明細（標記為 2）
- 第 338-386 行：輔導紀錄回應（標記為 3）

---

## 四、撥付進度需求

### 10. 補助款撥付進度表格
**需求**：
| 撥款款期 | 公文發出日期 | 入帳日期 |
|---------|------------|---------|
| 第一期   |            |         |
| 第二期   |            |         |
| 第三期   |            |         |
| 第四期款 |            |         |

**狀態**：⚠️ 部分實現
**問題**：
- `types.ts` 中 `GrantStage` 有 `submissionDate`（檢送日期）、`deadline`（截止日期）、`paymentDate`（入帳日期）
- 但缺少「公文發出日期」欄位
- `GrantProgress.tsx` UI 顯示的是「檢送日期」和「截止日期」，不是「公文發出日期」和「入帳日期」
**需要修改**：
1. 更新 `types.ts` 添加 `documentSentDate`（公文發出日期）
2. 更新 `GrantProgress.tsx` UI 顯示正確的欄位

### 11. 撥付進度要能填寫每一期款的截止日期
**需求**：撥付進度要能填寫每一期款的截止日期
**狀態**：✅ 已實現
**程式碼位置**：
- `ProjectForm.tsx` 第 201-228 行：撥付截止日期管理區塊
- `GrantProgress.tsx` 第 94-104 行：截止日期輸入欄位

### 12. 「建立日期」改成「檢送日期」
**需求**：「建立日期」改成「檢送日期」，文化部檢核是獨立的檢核點
**狀態**：✅ 已實現
**程式碼位置**：
- `types.ts` 第 144 行：`submissionDate?: string; // 檢送日期`
- `GrantProgress.tsx` 第 85 行：顯示「檢送日期」

### 13. 文化部檢核獨立檢核點
**需求**：文化部檢核是獨立的檢核點
**狀態**：✅ 已實現
**程式碼位置**：
- `types.ts` 第 147-148 行：`mocFinalCheck: MOCCheckStatus; mocRemark?: string;`
- `GrantProgress.tsx` 第 142-201 行：文化部最終檢核獨立區塊

---

## 五、輔導紀錄需求

### 14. 輔導紀錄可以新增但無法編輯
**需求**：輔導紀錄可以新增但無法編輯 → 需要修復讓操作人員也能編輯
**狀態**：✅ 已修復
**程式碼位置**：`CoachingRecords.tsx` 第 51-55 行
```javascript
const handleOpenEdit = (record: CoachingRecord) => {
  // 允許所有人編輯輔導紀錄
  setEditingRecord({...record});
  setShowModal(true);
};
```

### 15. 輔導紀錄序號格式
**需求**：序號就是年度+計畫編號+序號
**狀態**：✅ 已實現
**程式碼位置**：`CoachingRecords.tsx` 第 28 行
```javascript
const serial = `${selectedProjectId}-CR-${(filteredRecords.length + 1).toString().padStart(2, '0')}`;
```

### 16. 輔導紀錄的「單位回應」加顏色區分
**需求**：輔導紀錄的「單位回應」加顏色區分
**狀態**：✅ 已實現
**程式碼位置**：`ProjectExecutionControl.tsx` 第 369-379 行
- 使用 `amber` 色系區分單位回應區塊
- 背景色：`bg-amber-50/50`
- 邊框色：`border-amber-200`
- 標籤色：`text-amber-600`

### 17. 輔導紀錄內容表格要能匯出 Word/PDF
**需求**：輔導紀錄內容表格要能匯出成 word 或 pdf 表單
**狀態**：❌ 未實現
**需要修改**：需要添加匯出功能按鈕和相關邏輯

---

## 六、帳號管理需求

### 18. 帳號管理加入刪除功能
**需求**：帳號管理加入刪除功能
**狀態**：✅ 已實現
**程式碼位置**：`AccountManagement.tsx`（已建立該組件）

---

## 七、側邊欄需求

### 19. 側邊的「經費預算」改成「經費支出」
**需求**：側邊的「經費預算」改成「經費支出」，與計畫資料中的經費預算明細同步
**狀態**：⚠️ 需要確認
**問題**：需要檢查 `Sidebar.tsx` 中的文字是否已更新

---

## 八、報表與預警需求

### 20. 預警作用
**需求**：重點是要有預警作用，以及匯出報表
**狀態**：❌ 未實現
**需要修改**：
1. 添加進度預警功能（符合進度/不符合進度的視覺化提示）
2. 添加報表匯出功能

### 21. 報表格式
**需求**：報表要長怎樣？例如可以用幾個「關鍵結果」，符合進度是幾個，不符合進度是幾個，然後算比例。預算金額和執行金額對照，然後算比例。
**狀態**：❌ 未實現
**需要修改**：需要添加報表生成功能

---

## 需要修復的項目清單（按優先順序）

### 高優先級
1. ❌ **ProjectForm.tsx 缺少完整基本資料欄位**
   - 計畫代表人、計畫聯絡人（含電話、手機）
   - 立案地址、聯絡地址
   - 實施地點（類型+詳細地點，支援多個）
   - 申請金額、核定金額
   - 輔導委員、主責人員

2. ❌ **KeyResult 缺少預算金額和實際執行金額欄位**
   - 更新 types.ts
   - 更新 ProjectForm.tsx UI

3. ❌ **撥付進度表格欄位不正確**
   - 應該是：撥款款期、公文發出日期、入帳日期
   - 目前是：檢送日期、截止日期

### 中優先級
4. ❌ **輔導紀錄匯出 Word/PDF 功能**
5. ❌ **報表生成與預警功能**

### 低優先級
6. ⚠️ **確認 Sidebar.tsx 文字是否正確**

---

## 總結

| 類別 | 已實現 | 部分實現 | 未實現 |
|-----|-------|---------|-------|
| 權限控制 | 1 | 0 | 0 |
| 計畫基本資料 | 1 | 1 | 3 |
| 執行管控表 | 1 | 1 | 0 |
| 撥付進度 | 2 | 1 | 0 |
| 輔導紀錄 | 3 | 0 | 1 |
| 帳號管理 | 1 | 0 | 0 |
| 報表預警 | 0 | 0 | 2 |
| **總計** | **9** | **3** | **6** |

**完成率**：約 50%（9/18 項完全實現）
